{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "028bb0f7",
   "metadata": {},
   "source": [
    "# DeCarpooling - Decentralized Carpooling Platform\n",
    "\n",
    "DeCarpooling is a web application that uses blockchain technology to create a secure and transparent platform for carpooling. It allows users to offer rides, book rides, and make payments using cryptocurrency.\n",
    "\n",
    "## Table of Contents\n",
    "1. [Features](#features)\n",
    "2. [Project Structure](#project-structure)\n",
    "3. [Key Components](#key-components)\n",
    "4. [Security Features](#security-features)\n",
    "5. [Development Mode](#development-mode)\n",
    "6. [Setup Instructions](#setup-instructions)\n",
    "\n",
    "## Features\n",
    "\n",
    "- **User Authentication**: Register, login, and manage your profile\n",
    "- **Two-Factor Authentication**: Enhanced security with OTP verification\n",
    "- **Offer Rides**: Drivers can offer rides with details (start/end location, price, seats)\n",
    "- **Search Rides**: Passengers can search for available rides\n",
    "- **Book Rides**: Secure booking process using smart contracts\n",
    "- **Blockchain Integration**: Rides are stored on the Ethereum blockchain for transparency\n",
    "- **IPFS Storage**: User profiles are stored on IPFS for decentralized data storage\n",
    "- **Payment Processing**: Built-in cryptocurrency transactions\n",
    "\n",
    "## Project Structure\n",
    "\n",
    "The application follows a standard Flask web application structure:\n",
    "\n",
    "- **Main App Files**:\n",
    "  - `main.py`: Entry point for the application\n",
    "  - `app.py`: Flask application setup and configuration\n",
    "  - `config.py`: Configuration settings for different environments\n",
    "  - `models.py`: Database models (User, Ride, Booking, Review)\n",
    "  - `routes.py`: Web routes and controllers\n",
    "\n",
    "- **Templates & Static Files**:\n",
    "  - `templates/`: HTML templates using Jinja2\n",
    "  - `static/`: CSS, JavaScript, and other static assets\n",
    "\n",
    "- **Blockchain & IPFS Integration**:\n",
    "  - `blockchain_service.py`: Service for interacting with Ethereum blockchain\n",
    "  - `ipfs_service.py`: Service for storing and retrieving data from IPFS\n",
    "  - `smart_contracts/`: Ethereum smart contracts\n",
    "\n",
    "## Key Components\n",
    "\n",
    "### 1. Database Models\n",
    "\n",
    "The application uses several key database models:\n",
    "\n",
    "- **User**: Stores user information including username, email, password hash, Ethereum address, and OTP settings for two-factor authentication.\n",
    "\n",
    "- **Ride**: Represents a carpooling offer with details about the start/end locations, price, available seats, and connection to the blockchain.\n",
    "\n",
    "- **Booking**: Records when a user books a ride, including transaction details and status.\n",
    "\n",
    "- **Review**: Allows users to leave ratings and reviews for drivers or passengers after a ride.\n",
    "\n",
    "### 2. Web Routes\n",
    "\n",
    "The main routes in the application include:\n",
    "\n",
    "- **Authentication**: `/login`, `/register`, `/logout`\n",
    "- **Ride Management**: `/offer-ride`, `/search-ride`, `/ride/<id>`, `/book-ride/<id>`, `/complete-ride/<id>`\n",
    "- **Profile Management**: `/profile`, `/update-profile`, `/setup-otp`, `/disable-otp`\n",
    "- **API Endpoints**: `/api/rides`, `/api/ride/<id>`, `/api/blockchain/rides`\n",
    "\n",
    "### 3. Blockchain Integration\n",
    "\n",
    "The app uses Ethereum blockchain to:\n",
    "\n",
    "- Record ride offers with smart contracts\n",
    "- Process booking payments securely\n",
    "- Track the status of rides (active, completed)\n",
    "\n",
    "The `BlockchainService` class in `blockchain_service.py` handles all interactions with the Ethereum network, including creating rides, booking rides, and retrieving ride information.\n",
    "\n",
    "### 4. IPFS Storage\n",
    "\n",
    "User profile data is stored on IPFS (InterPlanetary File System), a decentralized storage network. This provides:\n",
    "\n",
    "- Permanent, decentralized storage of user information\n",
    "- Verified user profiles that can't be easily tampered with\n",
    "\n",
    "The `IPFSStorage` class in `ipfs_service.py` manages uploading and retrieving data from IPFS.\n",
    "\n",
    "## Security Features\n",
    "\n",
    "### Two-Factor Authentication\n",
    "\n",
    "The application includes Two-Factor Authentication (2FA) using time-based one-time passwords (TOTP):\n",
    "\n",
    "- Users can enable 2FA from their profile page\n",
    "- A QR code is provided to scan with authenticator apps (like Google Authenticator)\n",
    "- Once enabled, login requires both password and a verification code\n",
    "\n",
    "Implementation details:\n",
    "- Uses the `pyotp` library to generate and verify codes\n",
    "- OTP settings are stored in the User model (`otp_secret`, `otp_enabled`, `otp_verified`)\n",
    "- Login process detects if 2FA is enabled and prompts for verification code\n",
    "\n",
    "## Development Mode\n",
    "\n",
    "The application includes a development mode that allows testing without actual blockchain or IPFS connections:\n",
    "\n",
    "- Set `DEV_MODE=true` in the `.env` file to enable\n",
    "- Blockchain transactions are simulated locally\n",
    "- IPFS storage is replaced with local file storage\n",
    "\n",
    "This makes development and testing easier without requiring actual cryptocurrency or external services.\n",
    "\n",
    "## Setup Instructions\n",
    "\n",
    "### Prerequisites\n",
    "\n",
    "- Python 3.10 or higher\n",
    "- PostgreSQL database\n",
    "- For production: Ethereum wallet and Infura account\n",
    "\n",
    "### Installation\n",
    "\n",
    "1. Clone the repository\n",
    "2. Create a virtual environment: `python -m venv venv`\n",
    "3. Activate the virtual environment:\n",
    "   - Windows: `venv\\Scripts\\activate`\n",
    "   - Unix/Mac: `source venv/bin/activate`\n",
    "4. Install dependencies: `pip install -r requirements.txt`\n",
    "\n",
    "### Configuration\n",
    "\n",
    "1. Copy `.env.example` to `.env`\n",
    "2. Update the values in `.env`:\n",
    "   - Set `SESSION_SECRET` for secure cookies\n",
    "   - Configure database connection in `DATABASE_URL`\n",
    "   - For development, set `DEV_MODE=true`\n",
    "   - For production, add Ethereum and IPFS credentials\n",
    "\n",
    "### Database Setup\n",
    "\n",
    "1. Create a PostgreSQL database\n",
    "2. Run the database migration: `python db_migrate_otp.py`\n",
    "\n",
    "### Running the Application\n",
    "\n",
    "- Development server: `flask run`\n",
    "- Production server: `gunicorn --bind 0.0.0.0:5000 main:app`\n",
    "\n",
    "Visit `http://localhost:5000` in your browser to access the application."
   ]
  }
 ],
 "metadata": {
  "language_info": {
   "name": "python"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
